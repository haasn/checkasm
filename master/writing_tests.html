<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>checkasm: Writing Tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">checkasm<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Assembly testing and benchmarking framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Writing Tests</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#test_structure">Basic Test Structure</a></li>
<li class="level1"><a href="#naming_conventions">API Naming Conventions</a><ul><li class="level2"><a href="#modern_api">Modern API (Recommended)</a></li>
<li class="level2"><a href="#legacy_api">Legacy/Short API</a></li>
</ul>
</li>
<li class="level1"><a href="#best_practices">Best Practices</a><ul><li class="level2"><a href="#bp_buffer_allocation">Buffer Allocation</a></li>
<li class="level2"><a href="#bp_buffer_init">Buffer Initialization</a></li>
<li class="level2"><a href="#bp_test_loops">Testing Multiple Configurations</a></li>
<li class="level2"><a href="#bp_random_params">Using Random Parameters</a></li>
<li class="level2"><a href="#bp_reporting">Organizing Reports</a></li>
</ul>
</li>
<li class="level1"><a href="#common_patterns">Common Test Patterns</a><ul><li class="level2"><a href="#pattern_2d">2D Buffer Processing</a></li>
<li class="level2"><a href="#pattern_state">State-Based Functions</a></li>
<li class="level2"><a href="#pattern_multi_output">Multiple Outputs</a></li>
<li class="level2"><a href="#pattern_custom_input">Custom Input Generation</a></li>
</ul>
</li>
<li class="level1"><a href="#advanced_topics">Advanced Topics</a><ul><li class="level2"><a href="#adv_float">Floating-Point Comparison</a></li>
<li class="level2"><a href="#adv_padding">Padding and Over-Write Detection</a></li>
<li class="level2"><a href="#bench_multiple">Benchmarking Multiple Configurations</a></li>
<li class="level2"><a href="#adv_bitdepth">Multi-Bitdepth Testing</a></li>
<li class="level2"><a href="#adv_failure">Custom Failure Reporting</a></li>
<li class="level2"><a href="#adv_mmx">MMX Functions (x86)</a></li>
</ul>
</li>
<li class="level1"><a href="#tips_tricks">Tips and Tricks</a><ul><li class="level2"><a href="#tips_deterministic">Deterministic Testing</a></li>
<li class="level2"><a href="#tips_selective">Selective Testing</a></li>
<li class="level2"><a href="#tips_verbose">Verbose Output</a></li>
<li class="level2"><a href="#tips_bench">Benchmarking Tips</a></li>
<li class="level2"><a href="#tips_helpers">Helper Macros</a></li>
</ul>
</li>
<li class="level1"><a href="#tests_next_steps">Next Steps</a></li>
</ul>
</div>
<div class="textblock"><p>This guide covers best practices and common patterns for writing checkasm tests.</p>
<h1><a class="anchor" id="test_structure"></a>
Basic Test Structure</h1>
<p>Before diving into advanced patterns and best practices, familiarize yourself with the basic test structure by reading the <a class="el" href="getting_started.html#quick_start">Quick Start Example</a>.</p>
<p>The typical test workflow is:</p><ol type="1">
<li>Allocate (aligned) buffers for test data</li>
<li>Declare the function signature with checkasm_declare</li>
<li>Check if the function should be tested with checkasm_check_func</li>
<li>Initialize test inputs and clear output buffers</li>
<li>Call both reference (checkasm_call_ref) and optimized (checkasm_call_new) implementations</li>
<li>Compare results with checkasm_check</li>
<li>Benchmark the optimized implementation with <a class="el" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28" title="Benchmark the optimized implementation.">checkasm_bench_new()</a></li>
<li>Report results with checkasm_report</li>
</ol>
<h1><a class="anchor" id="naming_conventions"></a>
API Naming Conventions</h1>
<p>checkasm supports two API naming styles:</p>
<h2><a class="anchor" id="modern_api"></a>
Modern API (Recommended)</h2>
<p>The modern API uses the <code>checkasm_</code> prefix for all functions:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, uint8_t *dst, <span class="keyword">const</span> uint8_t *src, <span class="keywordtype">int</span> len);</div>
<div class="line"><a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;func, <span class="stringliteral">&quot;func_name&quot;</span>)</div>
<div class="line"><a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, src, len);</div>
<div class="line"><a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, src, len);</div>
<div class="line"><a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(uint8_t, dst_c, 0, dst_a, 0, len, 1, &quot;dst&quot;);</div>
<div class="line"><a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(dst_a, src, len);</div>
<div class="line"><a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(&quot;func_name&quot;);</div>
<div class="line"><a class="code hl_define" href="test_8h.html#a771deac0c048cccc98cf872c7a8d36a3">checkasm_fail</a>()</div>
<div class="line"><a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(buf0, buf1)</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="ttc" id="agroup__bufcmp_html_gaa1b1c38ee8da84d7a12c2171868c8e1d"><div class="ttname"><a href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a></div><div class="ttdeci">#define checkasm_check(type,...)</div><div class="ttdoc">Compare two 2D buffers and fail test if different.</div><div class="ttdef"><b>Definition</b> utils.h:480</div></div>
<div class="ttc" id="atest_8h_html_a012d866e2f2a5f5ede4b9c2765248e28"><div class="ttname"><a href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a></div><div class="ttdeci">#define checkasm_bench_new(...)</div><div class="ttdoc">Benchmark the optimized implementation.</div><div class="ttdef"><b>Definition</b> test.h:406</div></div>
<div class="ttc" id="atest_8h_html_a22fdeb651a1cc4ecddaef384da98dada"><div class="ttname"><a href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a></div><div class="ttdeci">#define checkasm_call_ref(...)</div><div class="ttdoc">Call the reference implementation.</div><div class="ttdef"><b>Definition</b> test.h:325</div></div>
<div class="ttc" id="atest_8h_html_a62b0579d89e3dff6c36448d06b393505"><div class="ttname"><a href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a></div><div class="ttdeci">CHECKASM_API void checkasm_report(const char *name,...) CHECKASM_PRINTF(1</div><div class="ttdoc">Report test outcome for a named group of functions.</div></div>
<div class="ttc" id="atest_8h_html_a6f2afbd0d6c3ba180d49cc9396543463"><div class="ttname"><a href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a></div><div class="ttdeci">#define checkasm_alternate(a, b)</div><div class="ttdoc">Alternate between two values during benchmarking.</div><div class="ttdef"><b>Definition</b> test.h:428</div></div>
<div class="ttc" id="atest_8h_html_a771deac0c048cccc98cf872c7a8d36a3"><div class="ttname"><a href="test_8h.html#a771deac0c048cccc98cf872c7a8d36a3">checkasm_fail</a></div><div class="ttdeci">#define checkasm_fail()</div><div class="ttdoc">Mark the current test as failed.</div><div class="ttdef"><b>Definition</b> test.h:103</div></div>
<div class="ttc" id="atest_8h_html_abca61f0321c4258cdc5203c9396fd51a"><div class="ttname"><a href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a></div><div class="ttdeci">#define checkasm_call_new(...)</div><div class="ttdoc">Call the implementation being tested with validation.</div><div class="ttdef"><b>Definition</b> test.h:340</div></div>
<div class="ttc" id="atest_8h_html_ac14b1acf6ab5851e8fe157b833dbd0a9"><div class="ttname"><a href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a></div><div class="ttdeci">#define checkasm_declare(ret,...)</div><div class="ttdoc">Declare a function signature for testing.</div><div class="ttdef"><b>Definition</b> test.h:149</div></div>
<div class="ttc" id="atest_8h_html_af89e132503dee480bf6d778f61046083"><div class="ttname"><a href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a></div><div class="ttdeci">#define checkasm_check_func(func,...)</div><div class="ttdoc">Check if a function should be tested and set up function references.</div><div class="ttdef"><b>Definition</b> test.h:309</div></div>
</div><!-- fragment --><h2><a class="anchor" id="legacy_api"></a>
Legacy/Short API</h2>
<p>For convenience and backwards compatibility, shorter aliases are available:</p>
<div class="fragment"><div class="line">declare_func(<span class="keywordtype">void</span>, uint8_t *dst, <span class="keyword">const</span> uint8_t *src, <span class="keywordtype">int</span> len);</div>
<div class="line">check_func(dsp-&gt;func, <span class="stringliteral">&quot;func_name&quot;</span>)</div>
<div class="line">call_ref(dst_c, src, len);</div>
<div class="line">call_new(dst_a, src, len);</div>
<div class="line"><span class="comment">// checkasm_check() has no short alias</span></div>
<div class="line">bench_new(dst_a, src, len);</div>
<div class="line">report(&quot;func_name&quot;);</div>
<div class="line">fail()</div>
<div class="line">alternate(buf0, buf1)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Both naming styles are fully supported and can be mixed within the same test file. However, for consistency and readability in documentation and new code, we recommend using the modern <code>checkasm_</code> prefixed names.</dd></dl>
<h1><a class="anchor" id="best_practices"></a>
Best Practices</h1>
<p>The remainder of this guide focuses on best practices, common patterns, and advanced testing scenarios.</p>
<h2><a class="anchor" id="bp_buffer_allocation"></a>
Buffer Allocation</h2>
<p>Always use properly aligned buffers for testing:</p>
<div class="fragment"><div class="line"><span class="comment">// For simple arrays</span></div>
<div class="line"><a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t buf[1024]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// For 2D buffers with automatic padding and stride calculation</span></div>
<div class="line"><span class="comment">// - Defines `dst` as a pointer to a 64x32 area, and `dst_stride` (in bytes)</span></div>
<div class="line"><a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst, 64, 32);</div>
<div class="ttc" id="agroup__bufcmp_html_gaf24227824feb841da0ad5b245c89cbf3"><div class="ttname"><a href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a></div><div class="ttdeci">#define CHECKASM_ALIGN(x)</div><div class="ttdoc">Declare a variable with platform-specific alignment requirements.</div><div class="ttdef"><b>Definition</b> utils.h:408</div></div>
<div class="ttc" id="agroup__bufrect_html_ga134be1495ed85b902e0488ff2dfa3cbc"><div class="ttname"><a href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a></div><div class="ttdeci">#define BUF_RECT(type, name, w, h)</div><div class="ttdoc">Declare an aligned, padded rectangular buffer.</div><div class="ttdef"><b>Definition</b> utils.h:553</div></div>
</div><!-- fragment --><p><b>Important:</b> Apply <a class="el" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3" title="Declare a variable with platform-specific alignment requirements.">CHECKASM_ALIGN()</a> to each buffer individually:</p>
<div class="fragment"><div class="line"><span class="comment">// Correct</span></div>
<div class="line"><a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t buf1[32]);</div>
<div class="line"><a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t buf2[32]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wrong - only buf1 will be aligned</span></div>
<div class="line"><a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t buf1[32], buf2[32]);</div>
</div><!-- fragment --><h2><a class="anchor" id="bp_buffer_init"></a>
Buffer Initialization</h2>
<p>checkasm provides several buffer initialization functions:</p>
<div class="fragment"><div class="line"><span class="comment">// Random data (uniformly distributed)</span></div>
<div class="line"><a class="code hl_define" href="group__memory.html#ga9b47d3dbddf9465c6bc1a0f34f9cabc9">RANDOMIZE_BUF</a>(buf);</div>
<div class="line"><a class="code hl_function" href="group__memory.html#ga3a1e99ab1046123c82d36a1f58efceea">checkasm_randomize</a>(buf, <span class="keyword">sizeof</span>(buf)); <span class="comment">// Equivalent to the above macro</span></div>
<div class="line"><a class="code hl_function" href="group__memory.html#ga90a24382b3e67a85c5a821d79c7f7dac">checkasm_randomize_mask8</a> (buf8,  width, 0x0F); <span class="comment">// Constrain value range</span></div>
<div class="line"><a class="code hl_function" href="group__memory.html#ga5a0da121f13ab1e9022a1507a280a18e">checkasm_randomize_mask16</a>(buf16, width, 1023); <span class="comment">// Random 10-bit values</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pathological test patterns (mix of edge cases and random bytes)</span></div>
<div class="line"><a class="code hl_define" href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a>(buf);</div>
<div class="line"><a class="code hl_function" href="group__memory.html#gae86384388849e6015465323c9c9e655d">checkasm_init</a>(buf, <span class="keyword">sizeof</span>(buf)); <span class="comment">// Equivalent to the above macro</span></div>
<div class="line"><a class="code hl_function" href="group__memory.html#gaeadfa94eae5f0728ffac59014439cb4f">checkasm_init_mask16</a>(buf16, width, (1 &lt;&lt; 12) - 1); <span class="comment">// Constrain to 12-bit range</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Clear to a constant value</span></div>
<div class="line"><a class="code hl_define" href="group__memory.html#gaa4b0d989c5896b64c44a8df25ab4a573">CLEAR_BUF</a>(buf);</div>
<div class="line"><a class="code hl_function" href="group__memory.html#ga4aabf591dd4dd533cdb6ba3cc0d841d9">checkasm_clear</a>(buf, <span class="keyword">sizeof</span>(buf)); <span class="comment">// Equivalent to the above macro</span></div>
<div class="line"><a class="code hl_function" href="group__memory.html#ga46b475befb58b79ec33ffd73b65d4ad3">checkasm_clear16</a>(buf16, width, 0x1234);</div>
<div class="ttc" id="agroup__memory_html_ga3a1e99ab1046123c82d36a1f58efceea"><div class="ttname"><a href="group__memory.html#ga3a1e99ab1046123c82d36a1f58efceea">checkasm_randomize</a></div><div class="ttdeci">CHECKASM_API void checkasm_randomize(void *buf, size_t bytes)</div><div class="ttdoc">Fill a buffer with uniformly chosen random bytes.</div></div>
<div class="ttc" id="agroup__memory_html_ga46b475befb58b79ec33ffd73b65d4ad3"><div class="ttname"><a href="group__memory.html#ga46b475befb58b79ec33ffd73b65d4ad3">checkasm_clear16</a></div><div class="ttdeci">CHECKASM_API void checkasm_clear16(uint16_t *buf, int width, uint16_t val)</div><div class="ttdoc">Fill a uint16_t buffer with a constant value.</div></div>
<div class="ttc" id="agroup__memory_html_ga4aabf591dd4dd533cdb6ba3cc0d841d9"><div class="ttname"><a href="group__memory.html#ga4aabf591dd4dd533cdb6ba3cc0d841d9">checkasm_clear</a></div><div class="ttdeci">CHECKASM_API void checkasm_clear(void *buf, size_t bytes)</div><div class="ttdoc">Clear a buffer to a pre-determined pattern (currently 0xAA)</div></div>
<div class="ttc" id="agroup__memory_html_ga5a0da121f13ab1e9022a1507a280a18e"><div class="ttname"><a href="group__memory.html#ga5a0da121f13ab1e9022a1507a280a18e">checkasm_randomize_mask16</a></div><div class="ttdeci">CHECKASM_API void checkasm_randomize_mask16(uint16_t *buf, int width, uint16_t mask)</div><div class="ttdoc">Fill a uint16_t buffer with random values chosen uniformly within a mask.</div></div>
<div class="ttc" id="agroup__memory_html_ga90a24382b3e67a85c5a821d79c7f7dac"><div class="ttname"><a href="group__memory.html#ga90a24382b3e67a85c5a821d79c7f7dac">checkasm_randomize_mask8</a></div><div class="ttdeci">CHECKASM_API void checkasm_randomize_mask8(uint8_t *buf, int width, uint8_t mask)</div><div class="ttdoc">Fill a uint8_t buffer with random values chosen uniformly within a mask.</div></div>
<div class="ttc" id="agroup__memory_html_ga9b47d3dbddf9465c6bc1a0f34f9cabc9"><div class="ttname"><a href="group__memory.html#ga9b47d3dbddf9465c6bc1a0f34f9cabc9">RANDOMIZE_BUF</a></div><div class="ttdeci">#define RANDOMIZE_BUF(buf)</div><div class="ttdoc">Fill a fixed size buffer wth random data (convenience macro)</div><div class="ttdef"><b>Definition</b> utils.h:261</div></div>
<div class="ttc" id="agroup__memory_html_gaa4b0d989c5896b64c44a8df25ab4a573"><div class="ttname"><a href="group__memory.html#gaa4b0d989c5896b64c44a8df25ab4a573">CLEAR_BUF</a></div><div class="ttdeci">#define CLEAR_BUF(buf)</div><div class="ttdoc">Clear a fixed size buffer (convenience macro)</div><div class="ttdef"><b>Definition</b> utils.h:254</div></div>
<div class="ttc" id="agroup__memory_html_gada713cfe880cb426001b9f92faf6f9f1"><div class="ttname"><a href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a></div><div class="ttdeci">#define INITIALIZE_BUF(buf)</div><div class="ttdoc">Fill a fixed size buffer with pathological test data (convenience macro)</div><div class="ttdef"><b>Definition</b> utils.h:269</div></div>
<div class="ttc" id="agroup__memory_html_gae86384388849e6015465323c9c9e655d"><div class="ttname"><a href="group__memory.html#gae86384388849e6015465323c9c9e655d">checkasm_init</a></div><div class="ttdeci">CHECKASM_API void checkasm_init(void *buf, size_t bytes)</div><div class="ttdoc">Initialize a buffer with pathological test patterns.</div></div>
<div class="ttc" id="agroup__memory_html_gaeadfa94eae5f0728ffac59014439cb4f"><div class="ttname"><a href="group__memory.html#gaeadfa94eae5f0728ffac59014439cb4f">checkasm_init_mask16</a></div><div class="ttdeci">CHECKASM_API void checkasm_init_mask16(uint16_t *buf, int width, uint16_t mask)</div><div class="ttdoc">Initialize a uint16_t buffer with pathological values within a mask.</div></div>
</div><!-- fragment --><p>For 2D buffers created with <a class="el" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc" title="Declare an aligned, padded rectangular buffer.">BUF_RECT()</a>:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, src, 64, 32);</div>
<div class="line"><a class="code hl_define" href="group__bufrect.html#gac6c629870114785925378fe47af16422">INITIALIZE_BUF_RECT</a>(src);  <span class="comment">// Initialize with pathological test bytes</span></div>
<div class="line"><a class="code hl_define" href="group__bufrect.html#ga3abfe25c549cceae1852fc25021111d2">RANDOMIZE_BUF_RECT</a>(tmp);   <span class="comment">// Fill with random data</span></div>
<div class="line"><a class="code hl_define" href="group__bufrect.html#ga52b49767d86fba82b34eb4b27c58b7d7">CLEAR_BUF_RECT</a>(dst);       <span class="comment">// Clear to constant data (currently 0xAA)</span></div>
<div class="ttc" id="agroup__bufrect_html_ga3abfe25c549cceae1852fc25021111d2"><div class="ttname"><a href="group__bufrect.html#ga3abfe25c549cceae1852fc25021111d2">RANDOMIZE_BUF_RECT</a></div><div class="ttdeci">#define RANDOMIZE_BUF_RECT(name)</div><div class="ttdoc">Randomize a rectangular buffer (including padding)</div><div class="ttdef"><b>Definition</b> utils.h:586</div></div>
<div class="ttc" id="agroup__bufrect_html_ga52b49767d86fba82b34eb4b27c58b7d7"><div class="ttname"><a href="group__bufrect.html#ga52b49767d86fba82b34eb4b27c58b7d7">CLEAR_BUF_RECT</a></div><div class="ttdeci">#define CLEAR_BUF_RECT(name)</div><div class="ttdoc">Clear a rectangular buffer (including padding)</div><div class="ttdef"><b>Definition</b> utils.h:570</div></div>
<div class="ttc" id="agroup__bufrect_html_gac6c629870114785925378fe47af16422"><div class="ttname"><a href="group__bufrect.html#gac6c629870114785925378fe47af16422">INITIALIZE_BUF_RECT</a></div><div class="ttdeci">#define INITIALIZE_BUF_RECT(name)</div><div class="ttdoc">Initialize a rectangular buffer (including padding) with pathological values.</div><div class="ttdef"><b>Definition</b> utils.h:578</div></div>
</div><!-- fragment --><p>See <a class="el" href="group__memory.html">Memory Initialization</a> for a full list of buffer initialization functions.</p>
<h2><a class="anchor" id="bp_test_loops"></a>
Testing Multiple Configurations</h2>
<p>Test functions across multiple configurations (e.g. block sizes) to ensure comprehensive coverage:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, src,   128, 128);</div>
<div class="line"><a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst_c, 128, 128);</div>
<div class="line"><a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst_a, 128, 128);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, uint8_t *dst, ptrdiff_t dst_stride,</div>
<div class="line">                       <span class="keyword">const</span> uint8_t *src, ptrdiff_t src_stride,</div>
<div class="line">                       <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Test various power-of-two block sizes, from 4x4 to 128x128</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 4; h &lt;= 128; h &lt;&lt;= 1) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> w = 4; w &lt;= 128; w &lt;&lt;= 1) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(get_func(w), <span class="stringliteral">&quot;func_%dx%d&quot;</span>, w, h)) {</div>
<div class="line">            <span class="comment">// Initialize test data - doing this inside the loop picks a</span></div>
<div class="line">            <span class="comment">// different data pattern for each test</span></div>
<div class="line">            <a class="code hl_define" href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a>(src);</div>
<div class="line">            <a class="code hl_define" href="group__memory.html#gaa4b0d989c5896b64c44a8df25ab4a573">CLEAR_BUF</a>(dst_c);</div>
<div class="line">            <a class="code hl_define" href="group__memory.html#gaa4b0d989c5896b64c44a8df25ab4a573">CLEAR_BUF</a>(dst_a);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Test this configuration</span></div>
<div class="line">            <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, dst_c_stride, src, src_stride, w, h);</div>
<div class="line">            <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, dst_a_stride, src, src_stride, w, h);</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_define" href="group__bufrect.html#ga9f805d46587abb0942eef42455436327">checkasm_check_rect_padded</a>(dst_c, dst_c_stride,</div>
<div class="line">                                       dst_a, dst_a_stride, w, h, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Benchmark this configuration</span></div>
<div class="line">            <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), dst_a_stride,</div>
<div class="line">                               src, src_stride, w, h);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;func&quot;</span>);</div>
<div class="ttc" id="agroup__bufrect_html_ga9f805d46587abb0942eef42455436327"><div class="ttname"><a href="group__bufrect.html#ga9f805d46587abb0942eef42455436327">checkasm_check_rect_padded</a></div><div class="ttdeci">#define checkasm_check_rect_padded(rect1,...)</div><div class="ttdoc">Compare two rectangular buffers including padding.</div><div class="ttdef"><b>Definition</b> utils.h:604</div></div>
</div><!-- fragment --><h2><a class="anchor" id="bp_random_params"></a>
Using Random Parameters</h2>
<p>Use <a class="el" href="group__rng.html#ga4aa346e83796f417cd7b1767d779d0fa" title="Generate a random non-negative integer.">checkasm_rand()</a> and related functions to generate diverse test inputs:</p>
<div class="fragment"><div class="line"><span class="comment">// Random integers</span></div>
<div class="line"><span class="keywordtype">int</span> <span class="keywordtype">byte</span> = <a class="code hl_function" href="group__rng.html#ga4aa346e83796f417cd7b1767d779d0fa">checkasm_rand</a>() &amp; 0xFF;</div>
<div class="line">uint32_t flags = <a class="code hl_function" href="group__rng.html#gaf0921f0cc5f91c60fa0a78708449d172">checkasm_rand_uint32</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Random floats</span></div>
<div class="line"><span class="keywordtype">double</span> d = <a class="code hl_function" href="group__rng.html#gace71cf48b3903afb2e75f919b4a586d8">checkasm_randf</a>();  <span class="comment">// [0.0, 1.0)</span></div>
<div class="line"><span class="keywordtype">float</span> f = (float) <a class="code hl_function" href="group__rng.html#gace71cf48b3903afb2e75f919b4a586d8">checkasm_randf</a>() * 100.0f;  <span class="comment">// [0.0, 100.0)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Normal distribution</span></div>
<div class="line"><span class="keywordtype">double</span> normal = <a class="code hl_function" href="utils_8h.html#a5b9a219bf2b4c9b6cd5fb78abc93ef60">checkasm_rand_norm</a>();  <span class="comment">// mean=0, stddev=1</span></div>
<div class="line"><a class="code hl_function" href="group__memory.html#ga2914a7cb52005e18568fa741f512024a">checkasm_randomize_normf</a>(buf, len);    <span class="comment">// Fill buffer with N(0,1)</span></div>
<div class="ttc" id="agroup__memory_html_ga2914a7cb52005e18568fa741f512024a"><div class="ttname"><a href="group__memory.html#ga2914a7cb52005e18568fa741f512024a">checkasm_randomize_normf</a></div><div class="ttdeci">CHECKASM_API void checkasm_randomize_normf(float *buf, int width)</div><div class="ttdoc">Fill a float buffer with values from a standard normal distribution.</div></div>
<div class="ttc" id="agroup__rng_html_ga4aa346e83796f417cd7b1767d779d0fa"><div class="ttname"><a href="group__rng.html#ga4aa346e83796f417cd7b1767d779d0fa">checkasm_rand</a></div><div class="ttdeci">CHECKASM_API int checkasm_rand(void)</div><div class="ttdoc">Generate a random non-negative integer.</div></div>
<div class="ttc" id="agroup__rng_html_gace71cf48b3903afb2e75f919b4a586d8"><div class="ttname"><a href="group__rng.html#gace71cf48b3903afb2e75f919b4a586d8">checkasm_randf</a></div><div class="ttdeci">CHECKASM_API double checkasm_randf(void)</div><div class="ttdoc">Generate a random double-precision floating-point number.</div></div>
<div class="ttc" id="agroup__rng_html_gaf0921f0cc5f91c60fa0a78708449d172"><div class="ttname"><a href="group__rng.html#gaf0921f0cc5f91c60fa0a78708449d172">checkasm_rand_uint32</a></div><div class="ttdeci">CHECKASM_API uint32_t checkasm_rand_uint32(void)</div><div class="ttdoc">Generate a random 32-bit unsigned integer.</div></div>
<div class="ttc" id="autils_8h_html_a5b9a219bf2b4c9b6cd5fb78abc93ef60"><div class="ttname"><a href="utils_8h.html#a5b9a219bf2b4c9b6cd5fb78abc93ef60">checkasm_rand_norm</a></div><div class="ttdeci">CHECKASM_API double checkasm_rand_norm(void)</div><div class="ttdoc">Generate a random number from the standard normal distribution.</div></div>
</div><!-- fragment --><p>See <a class="el" href="group__rng.html">Random Number Generation</a> for a full list of random number generation functions.</p>
<h2><a class="anchor" id="bp_reporting"></a>
Organizing Reports</h2>
<p>Group related functions and use <a class="el" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505" title="Report test outcome for a named group of functions.">checkasm_report()</a> strategically:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_add_functions(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Test multiple related functions</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bpc = 8; bpc &lt;= 12; bpc += 2) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(get_add8(bpc), <span class="stringliteral">&quot;add8_%dbpc&quot;</span>, bpc)) {</div>
<div class="line">            <span class="comment">// Test add8</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(get_add16(bpc), <span class="stringliteral">&quot;add16_%dbpc&quot;</span>, bpc)) {</div>
<div class="line">            <span class="comment">// Test add16</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report once for the whole group</span></div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="common_patterns"></a>
Common Test Patterns</h1>
<h2><a class="anchor" id="pattern_2d"></a>
2D Buffer Processing</h2>
<p>For functions operating on 2D buffers with stride:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_filter(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Define padded 64x64 buffers</span></div>
<div class="line">    <a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, src,   64, 64);</div>
<div class="line">    <a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst_c, 64, 64);</div>
<div class="line">    <a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst_a, 64, 64);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, uint8_t *dst, ptrdiff_t dst_stride,</div>
<div class="line">                     <span class="keyword">const</span> uint8_t *src, ptrdiff_t src_stride,</div>
<div class="line">                     <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> w = 4; w &lt;= 64; w &lt;&lt;= 1) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;filter, <span class="stringliteral">&quot;filter_w%d&quot;</span>, w)) {</div>
<div class="line">            <span class="comment">// Check multiple heights</span></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 4; h &lt;= 64; h &lt;&lt;= 1) {</div>
<div class="line">                <a class="code hl_define" href="group__bufrect.html#gac6c629870114785925378fe47af16422">INITIALIZE_BUF_RECT</a>(src);</div>
<div class="line">                <a class="code hl_define" href="group__bufrect.html#ga52b49767d86fba82b34eb4b27c58b7d7">CLEAR_BUF_RECT</a>(dst_c);</div>
<div class="line">                <a class="code hl_define" href="group__bufrect.html#ga52b49767d86fba82b34eb4b27c58b7d7">CLEAR_BUF_RECT</a>(dst_a);</div>
<div class="line"> </div>
<div class="line">                <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, dst_c_stride, src, src_stride, w, h);</div>
<div class="line">                <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, dst_a_stride, src, src_stride, w, h);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// Check buffers including padding</span></div>
<div class="line">                <a class="code hl_define" href="group__bufrect.html#ga9f805d46587abb0942eef42455436327">checkasm_check_rect_padded</a>(dst_c, dst_c_stride,</div>
<div class="line">                                           dst_a, dst_a_stride,</div>
<div class="line">                                           w, h, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Benchmark only the full height configuration</span></div>
<div class="line">            <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), dst_a_stride,</div>
<div class="line">                               src, src_stride, w, 64);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;filter&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="pattern_state"></a>
State-Based Functions</h2>
<p>For functions that modify internal state or have side effects:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_decoder(<span class="keyword">const</span> DecoderContext *dec)</div>
<div class="line">{</div>
<div class="line">    DecoderState state_c, state_a;</div>
<div class="line">    uint8_t bitstream[128];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize bitstream with random data</span></div>
<div class="line">    <a class="code hl_define" href="group__memory.html#ga9b47d3dbddf9465c6bc1a0f34f9cabc9">RANDOMIZE_BUF</a>(bitstream);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">int</span>, DecoderState *state, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">int</span> len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dec-&gt;decode, <span class="stringliteral">&quot;decode&quot;</span>)) {</div>
<div class="line">        <span class="comment">// Initialize both states identically</span></div>
<div class="line">        init_decoder_state(&amp;state_c, bitstream, 128);</div>
<div class="line">        init_decoder_state(&amp;state_a, bitstream, 128);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Decode and compare</span></div>
<div class="line">        <span class="keywordtype">int</span> result_c = <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(&amp;state_c, bitstream, 128);</div>
<div class="line">        <span class="keywordtype">int</span> result_a = <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(&amp;state_a, bitstream, 128);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compare return values</span></div>
<div class="line">        <span class="keywordflow">if</span> (result_c != result_a) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#a771deac0c048cccc98cf872c7a8d36a3">checkasm_fail</a>()) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;return value mismatch: %d vs %d\n&quot;</span>,</div>
<div class="line">                        result_c, result_a);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compare final states (optional)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// The validity of this check depends on whether or not `DecoderState`</span></div>
<div class="line">        <span class="comment">// has padding bytes or non-deterministic internal state.</span></div>
<div class="line">        <a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(uint8_t, &amp;state_c, 0, &amp;state_a, 0,</div>
<div class="line">                       <span class="keyword">sizeof</span>(DecoderState), 1, <span class="stringliteral">&quot;decoder state&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(&amp;state_a, bitstream, 128);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;decode&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="pattern_multi_output"></a>
Multiple Outputs</h2>
<p>For functions that produce multiple output values:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_stats(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t buf[64 * 64]);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">int</span>, <span class="keyword">const</span> uint8_t *buf, <span class="keywordtype">int</span> len,</div>
<div class="line">                     <span class="keywordtype">unsigned</span> *variance, <span class="keywordtype">unsigned</span> *sum);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;compute_stats, <span class="stringliteral">&quot;compute_stats&quot;</span>)) {</div>
<div class="line">        <span class="keywordtype">unsigned</span> var_c, var_a, sum_c, sum_a;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a>(buf);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> result_c = <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(buf, 64*64, &amp;var_c, &amp;sum_c);</div>
<div class="line">        <span class="keywordtype">int</span> result_a = <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(buf, 64*64, &amp;var_a, &amp;sum_a);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compare all outputs</span></div>
<div class="line">        <span class="keywordflow">if</span> (result_c != result_a || var_c != var_a || sum_c != sum_a) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#a771deac0c048cccc98cf872c7a8d36a3">checkasm_fail</a>()) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;result: %d vs %d, var: %u vs %u, sum: %u vs %u\n&quot;</span>,</div>
<div class="line">                        result_c, result_a, var_c, var_a, sum_c, sum_a);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(buf, 64*64, &amp;var_a, &amp;sum_a);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;compute_stats&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="pattern_custom_input"></a>
Custom Input Generation</h2>
<p>For functions requiring specific test patterns:</p>
<div class="fragment"><div class="line"><span class="comment">// Generate worst-case inputs to stress the implementation</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> generate_worst_case(uint16_t *buf, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> bitdepth_max)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Create reverse sorted sequence of input values</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; len; i++)</div>
<div class="line">        buf[i] = (len - 1 - i) &amp; bitdepth_max;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_transform(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">    #define WIDTH 64</span></div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(int16_t src  [WIDTH]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(int16_t dst_c[WIDTH]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(int16_t dst_a[WIDTH]);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, int16_t *dst, <span class="keyword">const</span> int16_t *src, <span class="keywordtype">int</span> width);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;transform, <span class="stringliteral">&quot;transform&quot;</span>)) {</div>
<div class="line">        <span class="comment">// Test with both random and worst-case inputs</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pattern = 0; pattern &lt; 2; pattern++) {</div>
<div class="line">            <span class="keywordflow">if</span> (pattern == 0) {</div>
<div class="line">                <a class="code hl_define" href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a>(src); <span class="comment">// Random input</span></div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                generate_worst_case(src, WIDTH, 32767); <span class="comment">// Worst case pattern</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_define" href="group__memory.html#gaa4b0d989c5896b64c44a8df25ab4a573">CLEAR_BUF</a>(dst_c);</div>
<div class="line">            <a class="code hl_define" href="group__memory.html#gaa4b0d989c5896b64c44a8df25ab4a573">CLEAR_BUF</a>(dst_a);</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, src, WIDTH);</div>
<div class="line">            <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, src, WIDTH);</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(int16_t, dst_c, 0, dst_a, 0, WIDTH, 1, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), src, WIDTH);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;transform&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="advanced_topics"></a>
Advanced Topics</h1>
<h2><a class="anchor" id="adv_float"></a>
Floating-Point Comparison</h2>
<p>For functions producing floating-point results, use tolerance-based comparison:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_float_func(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">    #define WIDTH 128</span></div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(<span class="keywordtype">float</span> src  [WIDTH]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(<span class="keywordtype">float</span> dst_c[WIDTH]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(<span class="keywordtype">float</span> dst_a[WIDTH]);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, <span class="keywordtype">float</span> *dst, <span class="keyword">const</span> <span class="keywordtype">float</span> *src, <span class="keywordtype">int</span> len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;process_float, <span class="stringliteral">&quot;process_float&quot;</span>)) {</div>
<div class="line">        <a class="code hl_function" href="group__memory.html#ga2914a7cb52005e18568fa741f512024a">checkasm_randomize_normf</a>(src, WIDTH);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, src, WIDTH);</div>
<div class="line">        <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, src, WIDTH);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compare with ULP (Units in Last Place) tolerance</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> max_ulp = 1;</div>
<div class="line">        <a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(float_ulp, dst_c, 0, dst_a, 0, WIDTH, 1, <span class="stringliteral">&quot;dst&quot;</span>, max_ulp);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Or use absolute epsilon tolerance</span></div>
<div class="line">        <span class="comment">// if (!checkasm_float_near_abs_eps_array(dst_c, dst_a, 1e-6f, WIDTH)) {</span></div>
<div class="line">        <span class="comment">//     checkasm_fail();</span></div>
<div class="line">        <span class="comment">// }</span></div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), src, WIDTH);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;process_float&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="adv_padding"></a>
Padding and Over-Write Detection</h2>
<p>Detect when functions write beyond their intended boundaries:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_bounds(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst_c, 64, 64);</div>
<div class="line">    <a class="code hl_define" href="group__bufrect.html#ga134be1495ed85b902e0488ff2dfa3cbc">BUF_RECT</a>(uint8_t, dst_a, 64, 64);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, uint8_t *dst, ptrdiff_t stride, <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;fill, <span class="stringliteral">&quot;fill&quot;</span>)) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> w = 64, h = 64;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="group__bufrect.html#ga52b49767d86fba82b34eb4b27c58b7d7">CLEAR_BUF_RECT</a>(dst_c);</div>
<div class="line">        <a class="code hl_define" href="group__bufrect.html#ga52b49767d86fba82b34eb4b27c58b7d7">CLEAR_BUF_RECT</a>(dst_a);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, dst_c_stride, w, h);</div>
<div class="line">        <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, dst_a_stride, w, h);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Standard check (no padding)</span></div>
<div class="line">        <a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(uint8_t, dst_c, dst_c_stride,</div>
<div class="line">                                dst_a, dst_a_stride, w, h, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check with padding detection (detects writes outside wh)</span></div>
<div class="line">        <a class="code hl_define" href="group__bufrect.html#ga9f805d46587abb0942eef42455436327">checkasm_check_rect_padded</a>(dst_c, dst_c_stride,</div>
<div class="line">                                   dst_a, dst_a_stride, w, h, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Allow over-write up to 16-element alignment on right edge</span></div>
<div class="line">        <a class="code hl_define" href="group__bufrect.html#ga4cc72d91e3ffa4a5222f822608c15694">checkasm_check_rect_padded_align</a>(dst_c, dst_c_stride,</div>
<div class="line">                                         dst_a, dst_a_stride,</div>
<div class="line">                                         w, h, <span class="stringliteral">&quot;dst&quot;</span>, 16, 1);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), dst_a_stride, w, h);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;fill&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__bufrect_html_ga4cc72d91e3ffa4a5222f822608c15694"><div class="ttname"><a href="group__bufrect.html#ga4cc72d91e3ffa4a5222f822608c15694">checkasm_check_rect_padded_align</a></div><div class="ttdeci">#define checkasm_check_rect_padded_align(rect1,...)</div><div class="ttdoc">Compare two rectangular buffers, with custom alignment (over-write)</div><div class="ttdef"><b>Definition</b> utils.h:620</div></div>
</div><!-- fragment --><h2><a class="anchor" id="bench_multiple"></a>
Benchmarking Multiple Configurations</h2>
<p>For functions that can be benchmarked at multiple configurations:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;filter, <span class="stringliteral">&quot;filter_w%d&quot;</span>, w)) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 4; h &lt;= 64; h &lt;&lt;= 1) {</div>
<div class="line">        <span class="comment">// Test all heights for correctness</span></div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, dst_c_stride, src, src_stride, w, h);</div>
<div class="line">        <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, dst_a_stride, src, src_stride, w, h);</div>
<div class="line">        <a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(uint8_t, dst_c, dst_c_stride,</div>
<div class="line">                                dst_a, dst_a_stride, w, h, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Benchmark each configuration</span></div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), dst_a_stride,</div>
<div class="line">                           src, src_stride, w, h);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The framework will report the geometric mean of all benchmark runs for</span></div>
<div class="line">    <span class="comment">// the same checkasm_check_func() call</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;filter_w%d&quot;</span>, w);</div>
</div><!-- fragment --><p>Alternatively, you could call <a class="el" href="test_8h.html#af89e132503dee480bf6d778f61046083" title="Check if a function should be tested and set up function references.">checkasm_check_func()</a> on each configuration to get a separate benchmark report for each size, or call <a class="el" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28" title="Benchmark the optimized implementation.">checkasm_bench_new()</a> only on the largest input size to test the limiting behavior.</p>
<h2><a class="anchor" id="adv_bitdepth"></a>
Multi-Bitdepth Testing</h2>
<p>For codecs supporting multiple bit depths:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_pixfunc(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    DSPContext dsp;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">    #define WIDTH 64</span></div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint16_t src  [WIDTH]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint16_t dst_c[WIDTH]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint16_t dst_a[WIDTH]);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9">checkasm_declare</a>(<span class="keywordtype">void</span>, uint16_t *dst, <span class="keyword">const</span> uint16_t *src, <span class="keywordtype">int</span> len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bpc = 10; bpc &lt;= 12; bpc += 2) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> bitdepth_max = (1 &lt;&lt; bpc) - 1;</div>
<div class="line">        dsp_context_init(&amp;dsp, <a class="code hl_function" href="checkasm_8h.html#ac576caad7a9c4333b1b3f34c345ca48b">checkasm_get_cpu_flags</a>(), bpc);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;process, <span class="stringliteral">&quot;process_%dbpc&quot;</span>, bpc)) {</div>
<div class="line">            <span class="comment">// Randomize within valid bit depth range</span></div>
<div class="line">            <a class="code hl_function" href="group__memory.html#ga5a0da121f13ab1e9022a1507a280a18e">checkasm_randomize_mask16</a>(src, WIDTH, bitdepth_max);</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(dst_c, src, WIDTH);</div>
<div class="line">            <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(dst_a, src, WIDTH);</div>
<div class="line">            <a class="code hl_define" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d">checkasm_check</a>(uint16_t, dst_c, 0, dst_a, 0, WIDTH, 1, <span class="stringliteral">&quot;dst&quot;</span>);</div>
<div class="line">            <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(<a class="code hl_define" href="test_8h.html#a6f2afbd0d6c3ba180d49cc9396543463">checkasm_alternate</a>(dst_a, dst_c), src, WIDTH);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;process&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="acheckasm_8h_html_ac576caad7a9c4333b1b3f34c345ca48b"><div class="ttname"><a href="checkasm_8h.html#ac576caad7a9c4333b1b3f34c345ca48b">checkasm_get_cpu_flags</a></div><div class="ttdeci">CHECKASM_API CheckasmCpu checkasm_get_cpu_flags(void)</div><div class="ttdoc">Get the current active set of CPU flags.</div></div>
</div><!-- fragment --><p>Alternatively, you may prefer to compile the test file itself multiple times, using preprocessor definitions like <code>-DBITDEPTH=10</code> etc.</p>
<h2><a class="anchor" id="adv_failure"></a>
Custom Failure Reporting</h2>
<p>Provide detailed diagnostics when tests fail:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_complex(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;complex, <span class="stringliteral">&quot;complex&quot;</span>)) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> param = 0; param &lt; 16; param++) {</div>
<div class="line">            <span class="keywordtype">int</span> result_c = <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(param);</div>
<div class="line">            <span class="keywordtype">int</span> result_a = <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(param);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Check return value</span></div>
<div class="line">            <span class="keywordflow">if</span> (result_c != result_a) {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#a771deac0c048cccc98cf872c7a8d36a3">checkasm_fail</a>()) {</div>
<div class="line">                    <span class="comment">// This branch is only executed if verbose error diagnostics</span></div>
<div class="line">                    <span class="comment">// are requested by the user</span></div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;return mismatch for param=%d: %d vs %d\n&quot;</span>,</div>
<div class="line">                            param, result_c, result_a);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;complex&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="adv_mmx"></a>
MMX Functions (x86)</h2>
<p>MMX functions on x86 often omit the <code>emms</code> instruction before returning, expecting the caller to execute it manually after a loop. The <code>emms</code> instruction is necessary to clear MMX state before any floating-point code can execute, but it can be very slow, so optimized loops that call into MMX kernels usually defer it to the loop end to minimize overhead.</p>
<p>Use <a class="el" href="test_8h.html#a3f7a0ce2c9ff46c217767cd2126de1fc" title="Declare signature for non-ABI compliant MMX functions (x86 only)">checkasm_declare_emms()</a> for such (non-ABI-compliant) functions:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> check_sad_mmx(<span class="keyword">const</span> DSPContext *dsp)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">    #define SIZE 16</span></div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t src [SIZE * SIZE]);</div>
<div class="line">    <a class="code hl_define" href="group__bufcmp.html#gaf24227824feb841da0ad5b245c89cbf3">CHECKASM_ALIGN</a>(uint8_t ref [SIZE * SIZE]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declaring with CPU_FLAG_MMX enables an automatic emms after calling</span></div>
<div class="line">    <span class="comment">// this function whenever CPU_FLAG_MMX is active</span></div>
<div class="line">    <a class="code hl_define" href="test_8h.html#a3f7a0ce2c9ff46c217767cd2126de1fc">checkasm_declare_emms</a>(CPU_FLAG_MMX, <span class="keywordtype">int</span>, <span class="keyword">const</span> uint8_t *src,</div>
<div class="line">                          <span class="keyword">const</span> uint8_t *ref, ptrdiff_t stride);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#af89e132503dee480bf6d778f61046083">checkasm_check_func</a>(dsp-&gt;sad_16x16, <span class="stringliteral">&quot;sad_16x16&quot;</span>)) {</div>
<div class="line">        <a class="code hl_define" href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a>(src);</div>
<div class="line">        <a class="code hl_define" href="group__memory.html#gada713cfe880cb426001b9f92faf6f9f1">INITIALIZE_BUF</a>(ref);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// checkasm will automatically call emms after checkasm_call_new()</span></div>
<div class="line">        <span class="keywordtype">int</span> result_c = <a class="code hl_define" href="test_8h.html#a22fdeb651a1cc4ecddaef384da98dada">checkasm_call_ref</a>(src, ref, SIZE);</div>
<div class="line">        <span class="keywordtype">int</span> result_a = <a class="code hl_define" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a">checkasm_call_new</a>(src, ref, SIZE);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (result_c != result_a) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_define" href="test_8h.html#a771deac0c048cccc98cf872c7a8d36a3">checkasm_fail</a>()) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;sad mismatch: %d vs %d\n&quot;</span>, result_c, result_a);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// checkasm will also call emms after benchmarking iterations</span></div>
<div class="line">        <a class="code hl_define" href="test_8h.html#a012d866e2f2a5f5ede4b9c2765248e28">checkasm_bench_new</a>(src, ref, SIZE);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="test_8h.html#a62b0579d89e3dff6c36448d06b393505">checkasm_report</a>(<span class="stringliteral">&quot;sad&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="atest_8h_html_a3f7a0ce2c9ff46c217767cd2126de1fc"><div class="ttname"><a href="test_8h.html#a3f7a0ce2c9ff46c217767cd2126de1fc">checkasm_declare_emms</a></div><div class="ttdeci">#define checkasm_declare_emms(cpu_flags, ret,...)</div><div class="ttdoc">Declare signature for non-ABI compliant MMX functions (x86 only)</div><div class="ttdef"><b>Definition</b> test.h:177</div></div>
</div><!-- fragment --><p>The first parameter is a CPU flag mask (e.g., <code>CPU_FLAG_MMX | CPU_FLAG_MMXEXT</code>). When any of the specified CPU flags are active, checkasm will call <code>emms</code> after each <a class="el" href="test_8h.html#abca61f0321c4258cdc5203c9396fd51a" title="Call the implementation being tested with validation.">checkasm_call_new()</a> and benchmark run. On non-x86 platforms, <a class="el" href="test_8h.html#a3f7a0ce2c9ff46c217767cd2126de1fc" title="Declare signature for non-ABI compliant MMX functions (x86 only)">checkasm_declare_emms()</a> is equivalent to <a class="el" href="test_8h.html#ac14b1acf6ab5851e8fe157b833dbd0a9" title="Declare a function signature for testing.">checkasm_declare()</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Modern SIMD instruction sets (SSE and later) do not use MMX registers and therefore don't require <code>emms</code>. Only use <a class="el" href="test_8h.html#a3f7a0ce2c9ff46c217767cd2126de1fc" title="Declare signature for non-ABI compliant MMX functions (x86 only)">checkasm_declare_emms()</a> for legacy MMX-only code or MMXEXT functions that explicitly use MMX registers.</dd></dl>
<h1><a class="anchor" id="tips_tricks"></a>
Tips and Tricks</h1>
<h2><a class="anchor" id="tips_deterministic"></a>
Deterministic Testing</h2>
<p>checkasm uses a seeded PRNG for reproducible tests. To test with a specific seed:</p>
<div class="fragment"><div class="line">./checkasm 12345  # Use seed 12345</div>
</div><!-- fragment --><p>Failed tests will print the seed used, allowing you to reproduce failures:</p>
<div class="fragment"><div class="line">checkasm: <span class="keyword">using </span>random seed 987654321</div>
<div class="line">...</div>
<div class="line">sad_16x16: FAILED (ref:1234 new:1235)</div>
</div><!-- fragment --><h2><a class="anchor" id="tips_selective"></a>
Selective Testing</h2>
<p>Test specific functions or groups:</p>
<div class="fragment"><div class="line"># Test only functions matching pattern</div>
<div class="line">./checkasm --function=&#39;add_*&#39;</div>
<div class="line"> </div>
<div class="line"># Test only a specific test module</div>
<div class="line">./checkasm --test=math</div>
<div class="line"> </div>
<div class="line"># Combine both</div>
<div class="line">./checkasm --test=dsp --function=&#39;blend_*&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="tips_verbose"></a>
Verbose Output</h2>
<p>Enable verbose mode for detailed failure information:</p>
<div class="fragment"><div class="line">./checkasm --verbose</div>
</div><!-- fragment --><p>This shows hexdumps of differing buffer regions automatically, when using the built-in <a class="el" href="group__bufcmp.html#gaa1b1c38ee8da84d7a12c2171868c8e1d" title="Compare two 2D buffers and fail test if different.">checkasm_check()</a> series of buffer comparison helpers.</p>
<h2><a class="anchor" id="tips_bench"></a>
Benchmarking Tips</h2>
<p>Run benchmarks with appropriate duration:</p>
<div class="fragment"><div class="line"># Quick benchmark (default)</div>
<div class="line">./checkasm --bench</div>
<div class="line"> </div>
<div class="line"># Longer benchmark for more accurate results (10ms per function)</div>
<div class="line">./checkasm --bench --duration=10000</div>
<div class="line"> </div>
<div class="line"># Export results in different formats</div>
<div class="line">./checkasm --bench --csv  &gt; results.csv</div>
<div class="line">./checkasm --bench --json &gt; results.json</div>
<div class="line">./checkasm --bench --html &gt; results.html</div>
</div><!-- fragment --><h2><a class="anchor" id="tips_helpers"></a>
Helper Macros</h2>
<p>Create helper macros to reduce repetition in your tests:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TEST_FILTER(name, w, h)                                       \</span></div>
<div class="line"><span class="preprocessor">    if (checkasm_check_func(dsp-&gt;name, #name &quot;_%dx%d&quot;, w, h)) {       \</span></div>
<div class="line"><span class="preprocessor">        test_filter_##name(dsp, w, h);                                \</span></div>
<div class="line"><span class="preprocessor">        checkasm_bench_new(dst, dst_stride, src, src_stride, w, h);   \</span></div>
<div class="line"><span class="preprocessor">    }</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Usage:</span></div>
<div class="line">TEST_FILTER(blur,    16, 16);</div>
<div class="line">TEST_FILTER(blur,    32, 32);</div>
<div class="line">TEST_FILTER(sharpen, 16, 16);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="tests_next_steps"></a>
Next Steps</h1>
<p>Now that you've mastered writing tests, learn how to accurately measure and compare the performance of your optimized implementations using checkasm's benchmarking capabilities.</p>
<p><b>Next:</b> <a class="el" href="benchmarking.html">Benchmarking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
