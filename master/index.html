<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>checkasm: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">checkasm<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Assembly testing and benchmarking framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introduction </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#features">Key Features</a><ul><li class="level2"><a href="#features_correctness">Correctness Verification</a></li>
<li class="level2"><a href="#features_benchmarking">Performance Benchmarking</a></li>
<li class="level2"><a href="#features_platform">Platform Support</a></li>
</ul>
</li>
<li class="level1"><a href="#links">Project Links</a><ul><li class="level2"><a href="#intro_next_steps">Next Steps</a></li>
</ul>
</li>
<li class="level1"><a href="#example_outputs">Example Outputs</a><ul><li class="level2"><a href="#example_benchmark">Benchmark Output</a></li>
<li class="level2"><a href="#example_errors">Error Reporting</a></li>
</ul>
</li>
<li class="level1"><a href="#license">License</a></li>
</ul>
</div>
<div class="textblock"><p><b>checkasm</b> is a robust, portable testing and benchmarking framework specifically designed for validating optimized assembly implementations against reference C code. Originally developed for the x264 encoder project, checkasm has grown considerably while in use by FFmpeg and dav1d, and now provides comprehensive correctness verification, crash detection, and accurate performance measurements across multiple architectures.</p>
<p>This project in particular stems from an effort to combine and improve upon multiple diverging checkasm forks in the wild (x264, FFmpeg, dav1d, etc.). It is a direct descendent of the dav1d variant, with all relevant enhancements from the FFmpeg fork merged in. It has since evolved into a fully fledged cross-platform standalone library and benchmarking framework.</p>
<h1><a class="anchor" id="features"></a>
Key Features</h1>
<h2><a class="anchor" id="features_correctness"></a>
Correctness Verification</h2>
<ul>
<li><b>Automated comparison</b> between reference (C) and optimized (assembly) implementations, including support for fuzzing implementations over multiple seeds and data patterns.</li>
<li><b>Detection of ABI violations</b> such as register misuse, illegal opcodes, or missing state cleanup.</li>
<li><b>Extensive data handling utilities</b> for defining, initializing, and comparing input/output buffers of various types, sizes and dimensionalities.</li>
<li><b>Crash resilience</b> including signal handling and stack smashing detection.</li>
</ul>
<h2><a class="anchor" id="features_benchmarking"></a>
Performance Benchmarking</h2>
<ul>
<li><b>Accurate cycle counting</b> using platform-specific high-resolution timers.</li>
<li><b>Statistical analysis</b> with robust outlier rejection, logarithmic regression and confidence intervals.</li>
<li><b>Comparative measurements</b> showing speedup of optimized code including comprehensive HTML reports.</li>
<li><b>Minimal overhead</b> to ensure realistic performance data, and high throughput.</li>
</ul>
<h2><a class="anchor" id="features_platform"></a>
Platform Support</h2>
<p>The following architectures are explicitly supported for asm verification, with the listed detection mechanisms for typical asm mistakes:</p>
<ul>
<li><b>x86, x86-64</b>: registers, stack, AVX2, MMX/FPU state</li>
<li><b>ARM, ARM64 (aarch64)</b>: registers, stack, NEON state</li>
<li><b>RISC-V</b>: registers, stack, vector state</li>
<li><b>LoongArch (32, 64)</b>: registers</li>
<li><b>PowerPC (64le)</b>: <em>none</em></li>
</ul>
<p>In addition, hardware timers are available for benchmarking purposes on all of the listed platforms (except RISCV-V), with fall-backs to generic OS-specific APIs.</p>
<h1><a class="anchor" id="links"></a>
Project Links</h1>
<ul>
<li><a href="https://code.videolan.org/videolan/checkasm"><b>GitLab Repository</b></a></li>
<li><a href="https://code.videlan.org/videolan/checkasm/issues"><b>Issue Tracker</b></a></li>
<li><a href="https://www.videolan.org/">VideoLAN Homepage</a></li>
</ul>
<h2><a class="anchor" id="intro_next_steps"></a>
Next Steps</h2>
<p>Continue learning about checkasm through the following guides:</p>
<ul>
<li><a class="el" href="getting_started.html">Getting Started</a> for a quick start guide</li>
<li><a class="el" href="integration.html">Integration Guide</a> for a guide on how to integrate checkasm into your project</li>
<li><a class="el" href="writing_tests.html">Writing Tests</a> for an in-depth explanation of writing tests</li>
<li><a class="el" href="benchmarking.html">Benchmarking</a> for tips and tricks on benchmarking with checkasm</li>
</ul>
<p>Or explore the full API reference:</p>
<ul>
<li><a class="el" href="checkasm_8h.html">checkasm.h</a> &ndash;  Main checkasm API for test suite configuration and execution.  </li>
<li><a class="el" href="test_8h.html">test.h</a> &ndash;  Test writing API for checkasm.  </li>
<li><a class="el" href="utils_8h.html">utils.h</a> &ndash;  Utility functions for checkasm tests.  </li>
</ul>
<h1><a class="anchor" id="example_outputs"></a>
Example Outputs</h1>
<h2><a class="anchor" id="example_benchmark"></a>
Benchmark Output</h2>
<p>This is what the output looks like, when using <code>--verbose</code> mode to print all timing data (on a pretty noisy/busy system):</p>
<div class="fragment"><div class="line">checkasm:</div>
<div class="line"> - CPU: Intel(R) Core(TM) Ultra 7 258V (000B06D1)</div>
<div class="line"> - Timing source: x86 (rdtsc)</div>
<div class="line"> - Timing resolution: 0.5976 +/- 0.057 ns/cycle (1644 +/- 156.8 MHz) (provisional)</div>
<div class="line"> - No-op overhead: 2.41 +/- 0.093 cycles per call (provisional)</div>
<div class="line"> - Bench duration: 10000 Âµs per function (18221161 cycles)</div>
<div class="line"> - Random seed: 3203178780</div>
<div class="line">C:</div>
<div class="line"> - msac.decode_symbol [OK]</div>
<div class="line"> - msac.decode_bool   [OK]</div>
<div class="line"> - msac.decode_hi_tok [OK]</div>
<div class="line">SSE2:</div>
<div class="line"> - msac.decode_symbol [OK]</div>
<div class="line"> - msac.decode_bool   [OK]</div>
<div class="line"> - msac.decode_hi_tok [OK]</div>
<div class="line">AVX2:</div>
<div class="line"> - msac.decode_symbol [OK]</div>
<div class="line">checkasm: all 15 tests passed</div>
<div class="line">Benchmark results:</div>
<div class="line">  name                               cycles +/- stddev         time (nanoseconds) (vs ref)</div>
<div class="line">  nop:                                  2.4 +/- 0.0             1.2 ns +/- 0.1</div>
<div class="line">  msac_decode_bool_c:                   6.3 +/- 0.2             3.3 ns +/- 0.4</div>
<div class="line">  msac_decode_bool_sse2:                5.7 +/- 0.2             3.0 ns +/- 0.4    ( 1.10x)</div>
<div class="line">  msac_decode_bool_adapt_c:             5.9 +/- 0.6             3.1 ns +/- 0.5</div>
<div class="line">  msac_decode_bool_adapt_sse2:          6.3 +/- 0.2             3.3 ns +/- 0.4    ( 0.94x)</div>
<div class="line">  msac_decode_bool_equi_c:              5.1 +/- 0.2             2.6 ns +/- 0.3</div>
<div class="line">  msac_decode_bool_equi_sse2:           2.8 +/- 0.1             1.4 ns +/- 0.2    ( 1.84x)</div>
<div class="line">  msac_decode_hi_tok_c:                64.9 +/- 75.4           33.8 ns +/- 40.8</div>
<div class="line">  msac_decode_hi_tok_sse2:             46.9 +/- 13.3           24.4 ns +/- 7.8    ( 1.22x)</div>
<div class="line">  msac_decode_symbol_adapt4_c:         12.6 +/- 0.7             6.5 ns +/- 0.9</div>
<div class="line">  msac_decode_symbol_adapt4_sse2:      12.3 +/- 0.8             6.4 ns +/- 0.9    ( 1.02x)</div>
<div class="line">  msac_decode_symbol_adapt8_c:         20.5 +/- 2.3            10.7 ns +/- 1.8</div>
<div class="line">  msac_decode_symbol_adapt8_sse2:      12.1 +/- 0.8             6.3 ns +/- 0.8    ( 1.68x)</div>
<div class="line">  msac_decode_symbol_adapt16_c:        33.6 +/- 1.2            17.5 ns +/- 2.1</div>
<div class="line">  msac_decode_symbol_adapt16_sse2:     13.8 +/- 0.6             7.2 ns +/- 0.9    ( 2.42x)</div>
<div class="line">  msac_decode_symbol_adapt16_avx2:     20.6 +/- 1.2            10.7 ns +/- 1.4    ( 1.62x)</div>
<div class="line"> - average timing error: 17.371% across 15 benchmarks (maximum 65.404%)</div>
</div><!-- fragment --><h2><a class="anchor" id="example_errors"></a>
Error Reporting</h2>
<p>This is what various failures could look like:</p>
<div class="fragment"><div class="line">checkasm:</div>
<div class="line"> - CPU: AMD Ryzen 9 9950X3D 16-Core Processor (00B40F40)</div>
<div class="line"> - Random seed: 3689286425</div>
<div class="line">x86:</div>
<div class="line"> - x86.copy                [OK]</div>
<div class="line">FAILURE: sigill_x86 (illegal instruction)</div>
<div class="line"> - x86.sigill              [FAILED]</div>
<div class="line">FAILURE: corrupt_stack_x86 (stack corruption)</div>
<div class="line"> - x86.corrupt_stack       [FAILED]</div>
<div class="line">FAILURE: clobber_r9_x86 (failed to preserve register: r9)</div>
<div class="line">FAILURE: clobber_r10_x86 (failed to preserve register: r10)</div>
<div class="line">FAILURE: clobber_r11_x86 (failed to preserve register: r11)</div>
<div class="line">FAILURE: clobber_r12_x86 (failed to preserve register: r12)</div>
<div class="line">FAILURE: clobber_r13_x86 (failed to preserve register: r13)</div>
<div class="line">FAILURE: clobber_r14_x86 (failed to preserve register: r14)</div>
<div class="line"> - x86.clobber             [FAILED]</div>
<div class="line">FAILURE: underwrite_64_x86 (../tests/generic.c:56)</div>
<div class="line">dst data (64x1):</div>
<div class="line">  0:  45 b3 dc aa 68 90 a4 5d cf d9 d9 9b d0 34     45 b3 dc aa 68 90 a4 5d cf d9 d9 9b d0 34    ..............</div>
<div class="line">      1b 88 37 0f 14 f1 77 f4 94 bf 53 a3 21 3f     1b 88 37 0f 14 f1 77 f4 94 bf 53 a3 21 3f    ..............</div>
<div class="line">      b5 64 77 fc 75 6b a9 2a 38 8a c7 e8 f9 1d     b5 64 77 fc 75 6b a9 2a 38 8a c7 e8 f9 1d    ..............</div>
<div class="line">      b4 80 d6 f4 34 1d c6 2b fd a8 e5 83 51 bb     b4 80 d6 f4 34 1d c6 2b fd a8 e5 83 51 bb    ..............</div>
<div class="line">      72 f6 e5 c1 47 80 63 f2                       72 f6 e5 c1 aa aa aa aa                      ....xxxx</div>
<div class="line"> - generic.underwrite      [FAILED]</div>
</div><!-- fragment --><h1><a class="anchor" id="license"></a>
License</h1>
<p>checkasm is licensed under the <b>2-clause BSD license</b>. See the LICENSE file in the repository for full details. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
